{
  "GUID": "165d34",
  "Name": "Custom_Tile",
  "Transform": {
    "posX": 35.98033,
    "posY": 1.43539345,
    "posZ": 13.7348175,
    "rotX": 0.0168968234,
    "rotY": 179.981873,
    "rotZ": 0.07987109,
    "scaleX": 15.1365757,
    "scaleY": 1,
    "scaleZ": 15.1365757
  },
  "Nickname": "Market",
  "Description": "Either use the Market Randomizer board or place a Randomizer Card onto this board.",
  "GMNotes": "",
  "AltLookAngle": {
    "x": 0,
    "y": 0,
    "z": 0
  },
  "ColorDiffuse": {
    "r": 0.02684565,
    "g": 0.131911755,
    "b": 0.2525788
  },
  "LayoutGroupSortIndex": 0,
  "Value": 0,
  "Locked": true,
  "Grid": true,
  "Snap": true,
  "IgnoreFoW": false,
  "MeasureMovement": false,
  "DragSelectable": true,
  "Autoraise": true,
  "Sticky": true,
  "Tooltip": true,
  "GridProjection": false,
  "HideWhenFaceDown": false,
  "Hands": false,
  "CustomImage": {
    "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/2064382397819368595/912A4617EDF764D7E18A67B8DA132E51464A8958/",
    "ImageSecondaryURL": "",
    "ImageScalar": 1,
    "WidthScale": 0,
    "CustomTile": {
      "Type": 3,
      "Thickness": 0.2,
      "Stackable": false,
      "Stretch": true
    }
  },
  "LuaScript": "marketBags = {\r\n    --gem bags\r\n    [\"Gem1\"] = \"c70854\",\r\n    [\"Gem2\"] = \"c70854\",\r\n    [\"Gem3\"] = \"a0ee7c\",\r\n    [\"Gem4\"] = \"326176\",\r\n    [\"Gem5\"] = \"76b9b1\",\r\n    [\"Gem6\"] = \"ae4191\",\r\n    [\"Gem7\"] = \"ae4191\",\r\n    [\"Spell1\"] = \"aef55f\",\r\n    [\"Spell2\"] = \"aef55f\",\r\n    [\"Spell3\"] = \"269f19\",\r\n    [\"Spell4\"] = \"6b6868\",\r\n    [\"Spell5\"] = \"70a46c\",\r\n    [\"Spell6\"] = \"c2eea0\",\r\n    [\"Spell7\"] = \"723b07\",\r\n    [\"Spell8\"] = \"6a9948\",\r\n    [\"Spell9\"] = \"6a9948\",\r\n    [\"Relic1\"] = \"0bcafd\",\r\n    [\"Relic2\"] = \"0bcafd\",\r\n    [\"Relic3\"] = \"f696d8\",\r\n    [\"Relic4\"] = \"5dd56e\",\r\n    [\"Relic5\"] = \"ca6d11\",\r\n    [\"Relic6\"] = \"f037fc\",\r\n    [\"Relic7\"] = \"ca0abc\",\r\n    [\"Relic8\"] = \"d42b3a\",\r\n    [\"Relic9\"] = \"d42b3a\"\r\n}\r\n\r\nswapBag = \"524f69\"\r\nswapCount = 1\r\nswapPosition = vector(50.45, 1.42, 5.04)\r\nswapDictionary =\r\n{\r\n    [\"[0DBF0D]Propel[-]\"] = \"[BF0DBF]Gather Force[-]\",\r\n    [\"[0DBF0D]Inscrutable Artifact[-]\"] = \"[BF0DBF]Aetherrune[-]\",\r\n    [\"[0DBF0D]Cavernous Maw[-]\"] = \"[BF0DBF]Dragonflare[-]\",\r\n    [\"[0DBF0D]Consume Magic[-]\"] = \"[BF0DBF]Detonate[-]\",\r\n    [\"[0DBF0D]Glowstone[-]\"] = \"[BF0DBF]Illuminite[-]\",\r\n    [\"[0DBF0D]Encased Fossil[-]\"] = \"[BF0DBF]Diamin[-]\",\r\n    [\"[0DBF0D]Fool's Gold[-]\"] = \"[BF0DBF]Smite[-]\",\r\n    [\"[0DBF0D]Harbinger Descent[-]\"] = \"[BF0DBF]Apocalypse[-]\"\r\n\r\n\r\n}\r\n\r\nzoneTable = {\r\n    [1] = \"243c0f\",\r\n    [2] = \"27cf5f\",\r\n    [3] = \"c08962\",\r\n    [4] = \"d46559\",\r\n    [5] = \"9bad65\",\r\n    [6] = \"5ce8bd\",\r\n    [7] = \"00e430\",\r\n    [8] = \"8bea37\",\r\n    [9] = \"e1bcd8\"\r\n}\r\n\r\nplayerBoardGUID = {\r\n    [1] = \"5ebb47\",\r\n    [2] = \"e87d81\",\r\n    [3] = \"7ff2e6\",\r\n    [4] = \"c3c58d\"\r\n}\r\n\r\n\r\n\r\ngem_random_deck_id = \"d35e87\"\r\nspell_random_deck_id = \"8cc318\"\r\nrelic_random_deck_id = \"bc68c5\"\r\ndestroyID = \"2f91ae\"\r\nbarracksID = \"d089df\"\r\nbarracksPos = getObjectFromGUID(barracksID).getPosition()\r\nlocked = false\r\n\r\ngem_random_script = '61d17d'\r\nrelic_random_script = 'feac97'\r\nspell_random_script = 'c04785'\r\n\r\npreventError = false\r\n\r\ndeckCostTable = {\r\n    [\"Cost0\"] = 0,\r\n    [\"Cost1\"] = 1,\r\n    [\"Cost2\"] = 2,\r\n    [\"Cost3\"] = 3,\r\n    [\"Cost4\"] = 4,\r\n    [\"Cost5\"] = 5,\r\n    [\"Cost6\"] = 6,\r\n    [\"Cost7\"] = 7,\r\n    [\"Cost8\"] = 8,\r\n    [\"Cost9\"] = 9\r\n}\r\n\r\naltCostTable =\r\n{\r\n  [1] = {[1] = 3, [2] = 3},\r\n  [2] = {[1] = 3,[2] =3},\r\n  [3] = {[1] = 3,[2] =4},\r\n  [4] = {[1] = 3,[2] =5},\r\n  [5] = {[1] = 4,[2] =6},\r\n  [6] = {[1] = 5,[2] =7},\r\n  [7] = {[1] = 6,[2] =8},\r\n  [8] = {[1] = 6,[2] =8},\r\n  [9] = {[1] = 7,[2] =8}\r\n}\r\ncost_plus = false\r\ncost_minus = false\r\nbarracksOffset = 1\r\n\r\nfunction resetOffset()\r\n  barracksOffset = 1\r\nend\r\n\r\nfunction resetError()\r\n  preventError = false\r\nend\r\n\r\n\r\nfunction setDecks()\r\n  gem_random_deck_id = findDecksInZone(getObjectFromGUID(gem_random_script)).getGUID()\r\n  getObjectFromGUID(gem_random_deck_id).shuffle()\r\n\r\n  relic_random_deck_id = findDecksInZone(getObjectFromGUID(relic_random_script)).getGUID()\r\n  getObjectFromGUID(relic_random_deck_id).shuffle()\r\n\r\n  spell_random_deck_id = findDecksInZone(getObjectFromGUID(spell_random_script)).getGUID()\r\n  getObjectFromGUID(spell_random_deck_id).shuffle()\r\nend\r\n\r\nfunction findDecksInZone(zone)\r\n    local objectsInZone = zone.getObjects()\r\n    local decksFound = {}\r\n    for i, object in ipairs(objectsInZone) do\r\n        if object.tag == \"Deck\" or object.tag == \"Card\" then\r\n            return getObjectFromGUID(object.guid)\r\n        end\r\n    end\r\n    if #decksFound > 0 then\r\n        return decksFound\r\n    else\r\n        return nil\r\n    end\r\nend\r\n\r\nfunction onLoad()\r\n    local buttonWidth = 320\r\n    local buttonHeight = 90\r\n    local buttonY = 0.9\r\n    local leftPos = -0.475\r\n    local middlePos = 0\r\n    local rightPos = leftPos + ((math.abs(leftPos) - math.abs(middlePos)) * 2)\r\n    local toolT = \"Reroll the card above for another card of the same cost and type.\\nThe former current market card is put into destroyed objects.\\n \\n [b]Right Click[/b] to allow slightly randomised cost leeway, but at the extreme ends of the cost spectrum it favours the alternative cost!\"\r\n    local toolTp = \"Reroll the card above for another card of the same type at cost +1.\"\r\n    local toolTm = \"Reroll the card above for another card of the same type at cost -1.\"\r\n    buttonParameters = {\r\n        Card1 = {\r\n            index = 0,\r\n            click_function = \"Card1\",\r\n            function_owner = self,\r\n            label = \"Re\",\r\n            position = {leftPos, buttonY, -0.3},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/2,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolT\r\n        },\r\n        Card2 = {\r\n            index = 1,\r\n            click_function = \"Card2\",\r\n            function_owner = self,\r\n            label = \"Re\",\r\n            position = {0, buttonY, -0.3},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/2,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolT\r\n        },\r\n        Card3 = {\r\n            index = 2,\r\n            click_function = \"Card3\",\r\n            function_owner = self,\r\n            label = \"Re\",\r\n            position = {rightPos, buttonY, -0.3},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/2,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolT\r\n        },\r\n        Card4 = {\r\n            index = 3,\r\n            click_function = \"Card4\",\r\n            function_owner = self,\r\n            label = \"Re\",\r\n            position = {leftPos, buttonY, 0.35},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/2,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolT\r\n        },\r\n        Card5 = {\r\n            index = 4,\r\n            click_function = \"Card5\",\r\n            function_owner = self,\r\n            label = \"Re\",\r\n            position = {0, buttonY, 0.35},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/2,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolT\r\n        },\r\n        Card6 = {\r\n            index = 5,\r\n            click_function = \"Card6\",\r\n            function_owner = self,\r\n            label = \"Re\",\r\n            position = {rightPos, buttonY, 0.35},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/2,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolT\r\n        },\r\n        Card7 = {\r\n            index = 6,\r\n            click_function = \"Card7\",\r\n            function_owner = self,\r\n            label = \"Re\",\r\n            position = {leftPos, buttonY, 0.95},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/2,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolT\r\n        },\r\n        Card8 = {\r\n            index = 7,\r\n            click_function = \"Card8\",\r\n            function_owner = self,\r\n            label = \"Re\",\r\n            position = {0, buttonY, 0.95},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/2,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolT\r\n        },\r\n        Card9 = {\r\n            index = 8,\r\n            click_function = \"Card9\",\r\n            function_owner = self,\r\n            label = \"Re\",\r\n            position = {rightPos, buttonY, 0.95},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/2,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolT\r\n        },\r\n        Lock = {\r\n            index = 9,\r\n            click_function = \"lockMarket\",\r\n            function_owner = self,\r\n            label = \"Lock\\nMarket\",\r\n            position = {0.92, 0.1, 0},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth*2,\r\n            height = buttonHeight*4,\r\n            color = {r = 0, g = 1, b = 1},\r\n            scale ={0.25,0.25,0.25},\r\n            font_size = 130,\r\n            tooltip = \"Locks in the market - This replaces the re-roll buttons with buy/gain buttons!\"\r\n        },\r\n        Card1p = {\r\n            index = 10,\r\n            click_function = \"Card1p\",\r\n            function_owner = self,\r\n            label = \"+\",\r\n            position = {leftPos+0.15, buttonY, -0.3},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTp\r\n        },\r\n        Card1m = {\r\n            index = 11,\r\n            click_function = \"Card1m\",\r\n            function_owner = self,\r\n            label = \"-\",\r\n            position = {leftPos-0.15, buttonY, -0.3},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTm\r\n        },\r\n        Card2p = {\r\n            index = 12,\r\n            click_function = \"Card2p\",\r\n            function_owner = self,\r\n            label = \"+\",\r\n            position = {0+0.15, buttonY, -0.3},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTp\r\n        },\r\n        Card2m = {\r\n            index = 13,\r\n            click_function = \"Card2m\",\r\n            function_owner = self,\r\n            label = \"-\",\r\n            position = {0-0.15, buttonY, -0.3},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTm\r\n        },\r\n        Card3p = {\r\n            index = 14,\r\n            click_function = \"Card3p\",\r\n            function_owner = self,\r\n            label = \"+\",\r\n            position = {rightPos+0.15, buttonY, -0.3},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTp\r\n        },\r\n        Card3m = {\r\n            index = 15,\r\n            click_function = \"Card3m\",\r\n            function_owner = self,\r\n            label = \"-\",\r\n            position = {rightPos-0.15, buttonY, -0.3},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTm\r\n        },\r\n        Card4p = {\r\n            index = 16,\r\n            click_function = \"Card4p\",\r\n            function_owner = self,\r\n            label = \"+\",\r\n            position = {leftPos+0.15, buttonY, 0.35},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTp\r\n        },\r\n        Card4m = {\r\n            index = 17,\r\n            click_function = \"Card4m\",\r\n            function_owner = self,\r\n            label = \"-\",\r\n            position = {leftPos-0.15, buttonY, 0.35},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTm\r\n        },\r\n        Card5p = {\r\n            index = 18,\r\n            click_function = \"Card5p\",\r\n            function_owner = self,\r\n            label = \"+\",\r\n            position = {0+0.15, buttonY, 0.35},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTp\r\n        },\r\n        Card5m = {\r\n            index = 19,\r\n            click_function = \"Card5m\",\r\n            function_owner = self,\r\n            label = \"-\",\r\n            position = {0-0.15, buttonY, 0.35},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTm\r\n        },\r\n        Card6p = {\r\n            index = 20,\r\n            click_function = \"Card6p\",\r\n            function_owner = self,\r\n            label = \"+\",\r\n            position = {rightPos+0.15, buttonY, 0.35},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTp\r\n        },\r\n        Card6m = {\r\n            index = 21,\r\n            click_function = \"Card6m\",\r\n            function_owner = self,\r\n            label = \"-\",\r\n            position = {rightPos-0.15, buttonY, 0.35},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTm\r\n        },\r\n        Card7p = {\r\n            index = 22,\r\n            click_function = \"Card7p\",\r\n            function_owner = self,\r\n            label = \"+\",\r\n            position = {leftPos+0.15, buttonY, 0.95},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTp\r\n        },\r\n        Card7m = {\r\n            index = 23,\r\n            click_function = \"Card7m\",\r\n            function_owner = self,\r\n            label = \"-\",\r\n            position = {leftPos-0.15, buttonY, 0.95},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTm\r\n        },\r\n        Card8p = {\r\n            index = 24,\r\n            click_function = \"Card8p\",\r\n            function_owner = self,\r\n            label = \"+\",\r\n            position = {0+0.15, buttonY, 0.95},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTp\r\n        },\r\n        Card8m = {\r\n            index = 25,\r\n            click_function = \"Card8m\",\r\n            function_owner = self,\r\n            label = \"-\",\r\n            position = {0-0.15, buttonY, 0.95},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTm\r\n        },\r\n        Card9p = {\r\n            index = 26,\r\n            click_function = \"Card9p\",\r\n            function_owner = self,\r\n            label = \"+\",\r\n            position = {rightPos+0.15, buttonY, 0.95},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTp\r\n        },\r\n        Card9m = {\r\n            index = 27,\r\n            click_function = \"Card9m\",\r\n            function_owner = self,\r\n            label = \"-\",\r\n            position = {rightPos-0.15, buttonY, 0.95},\r\n            rotation = {0, 0, 0},\r\n            width = buttonWidth/3,\r\n            height = buttonHeight,\r\n            scale ={0.5,0.5,0.5},\r\n            font_size = 60,\r\n            tooltip = toolTm\r\n        },\r\n    }\r\n\r\n    for i, v in pairs(buttonParameters) do\r\n        self.createButton(v)\r\n    end\r\nend\r\n\r\nfunction rerollCard(pos,altclick)\r\n    --print(altclick)\r\n\r\n    deckObj = findDecksInZone(getObjectFromGUID(zoneTable[pos]))\r\n    if deckObj == nil then\r\n        broadcastToAll(\"No cards found at market position \" .. tostring(pos) .. \"!\", {r = 1, g = 0, b = 0})\r\n        return (nil)\r\n    else\r\n        setDecks()\r\n        local deckType = \"\"\r\n        local deckCost = \"\"\r\n        if deckObj.hasTag(\"gemDeck\") or deckObj.hasTag(\"gemCard\") then\r\n            deckType = \"Gem\"\r\n        elseif deckObj.hasTag(\"spellDeck\") or deckObj.hasTag(\"spellCard\") then\r\n            deckType = \"Spell\"\r\n        elseif deckObj.hasTag(\"relicDeck\") or deckObj.hasTag(\"relicCard\") then\r\n            deckType = \"Relic\"\r\n        else\r\n            broadcastToAll(\r\n                \"Invalid deck type/missing type tag at position \" .. tostring(pos) .. \"!\",\r\n                {r = 1, g = 0, b = 0}\r\n            )\r\n            return (nil)\r\n        end\r\n        --print(deckType)\r\n        local maxCost = 7\r\n        local minCost = 2\r\n        local hardMax = 8\r\n        if deckType == \"Gem\" then\r\n          hardMax = 6\r\n        end\r\n        local GemMinCost = 2\r\n        local GemMaxCost = 7\r\n        local RelicMinCost = 1\r\n        local RelicMaxCost = 8\r\n        local SpellMinCost = 1\r\n        local SpellMaxCost = 9\r\n        if (deckObj.getGMNotes() ~= \"\" and tonumber(deckObj.getGMNotes()) ~= nil) then\r\n          --and tonumber(deckObj.getGMNotes()) ~= 2 and tonumber(deckObj.getGMNotes()) < hardMax\r\n          --^ old code check that I don't think is needed\r\n          if (cost_plus == true) then\r\n            cost_plus = false\r\n            deckCost = deckObj.getGMNotes() + 1\r\n            if deckType == \"Gem\" and deckCost>GemMaxCost then\r\n              broadcastToAll(\"No more expensive gem!\", {r = 1, g = 0, b = 0})\r\n              return\r\n            end\r\n            if deckType == \"Relic\" and deckCost>RelicMaxCost then\r\n              broadcastToAll(\"No more expensive relic!\", {r = 1, g = 0, b = 0})\r\n              return\r\n            end\r\n            if deckType == \"Spell\" and deckCost>SpellMaxCost then\r\n              broadcastToAll(\"No more expensive spell!\", {r = 1, g = 0, b = 0})\r\n              return\r\n            end\r\n          elseif (cost_minus == true) then\r\n            cost_minus = false\r\n            deckCost = deckObj.getGMNotes() - 1\r\n            if deckType == \"Gem\" and deckCost<GemMinCost then\r\n              broadcastToAll(\"No less expensive gem!\", {r = 1, g = 0, b = 0})\r\n              return\r\n            end\r\n            if deckType == \"Relic\" and deckCost<RelicMinCost then\r\n              broadcastToAll(\"No less expensive relic!\", {r = 1, g = 0, b = 0})\r\n              return\r\n            end\r\n            if deckType == \"Spell\" and deckCost<SpellMinCost then\r\n              broadcastToAll(\"No less expensive spell!\", {r = 1, g = 0, b = 0})\r\n              return\r\n            end\r\n          else\r\n            if (altclick == true) then\r\n              minCost = altCostTable[tonumber(deckObj.getGMNotes())][1]\r\n              maxCost = altCostTable[tonumber(deckObj.getGMNotes())][2]\r\n              deckCost = math.random(minCost,maxCost)\r\n              if deckType == \"Gem\" and deckCost > 6 then\r\n                deckCost = 6\r\n              end\r\n            else\r\n                deckCost = deckObj.getGMNotes()\r\n            end\r\n          end\r\n\r\n        else\r\n            broadcastToAll(\r\n                \"Invalid cost type/missing cost tag at position \" .. tostring(pos) .. \"!\",\r\n                {r = 1, g = 0, b = 0}\r\n            )\r\n            return (nil)\r\n        end\r\n        --print(deckCost)\r\n        --print(deckObj.getName())\r\n        --print(deckType .. deckCost)\r\n        local destroyObj = getObjectFromGUID(destroyID)\r\n        deckObj.setPositionSmooth(destroyObj.getPosition() + vector(0,5,0), false, true)\r\n        searchDeck(\r\n            getObjectFromGUID(barracksID),\r\n            deckObj.getName(),\r\n            destroyObj.getPosition() + vector(0,2,0),\r\n            deckObj.getRotation(),\r\n            \"Name\",\r\n            \"Randomiser card not found in Barracks!\"\r\n        )\r\n        print(\"Re-rolling card at position \" .. tostring(pos))\r\n        getShopCard(deckType .. deckCost, deckType, getObjectFromGUID(zoneTable[pos]))\r\n    end\r\nend\r\n\r\nfunction grabCard(color, error, myDeck)\r\n    deckObj = findDecksInZone(getObjectFromGUID(myDeck))\r\n    if deckObj == nil then\r\n        broadcastToAll(error, {r = 1, g = 0, b = 0})\r\n        return (nil)\r\n    end\r\n    if color == \"White\" then\r\n        myBoard = playerBoardGUID[1]\r\n    elseif color == \"Orange\" then\r\n        myBoard = playerBoardGUID[2]\r\n    elseif color == \"Blue\" then\r\n        myBoard = playerBoardGUID[3]\r\n    elseif color == \"Purple\" then\r\n        myBoard = playerBoardGUID[4]\r\n    end\r\n    local boardPos = getObjectFromGUID(myBoard)\r\n    if deckObj.type == \"Card\" then\r\n        deckObj.setPositionSmooth(boardPos.getPosition() + vector(14, 3, -6.4),false,true)\r\n        deckObj.setRotationSmooth({0.00, 180.00, 0.00})\r\n    elseif deckObj.type == \"Deck\" then\r\n      deckObj.takeObject({\r\n        position = deckObj.getPosition(),\r\n        smooth = false,\r\n        rotation = {0.00, 180.00, 0.00},\r\n        callback_function = function(obj)\r\n          if obj then\r\n            obj.setPositionSmooth(boardPos.getPosition() + vector(14, 3, -6.4), false, true)\r\n          end\r\n        end\r\n      })\r\n    end\r\nend\r\n\r\nfunction buyCard(pos, playerC)\r\n    --print(\"Re-roll card at position \" .. tostring(pos) .. \"  \"  .. playerC)\r\n    local myDeck = findDecksInZone(getObjectFromGUID(zoneTable[pos]))\r\n    grabCard(playerC, \"No cards found at market position \" .. tostring(pos) .. \"!\", zoneTable[pos])\r\nend\r\n\r\n--[[function getShopCard(box, type, pos)\r\n  --print(marketBags[box])\r\n  --print(pos)\r\n    cardBox = getObjectFromGUID(marketBags[box])\r\n    --print(cardBox)\r\n    marketPos = getObjectFromGUID(pos)\r\n    cardBoxSize = tablelength(cardBox.getObjects())\r\n    if cardBoxSize == 0 then\r\n      broadcastToAll(\"You've either ran out of cards to randomise or something went wrong!\\nYou may have to fix this manually, grab a card from the randomiser decks!\",{r=1,g=0.7,b=0.7})\r\n      return(nil)\r\n    end\r\n    possible_cards = cardBoxSize\r\n    chosen_card = math.random(0, possible_cards - 1)\r\n    params = {index = chosen_card, position = marketPos.getPosition() + vector(0,3,0), rotation = {x = 0, y = 180, z = 0}, smooth = false}\r\n    card_stack = cardBox.takeObject(params)\r\n\r\n  --  card_stack.setRotation({x = 0, y = 180, z = 0})\r\n    --card_stack.setPositionSmooth(market.getPosition() + vector(0,3,0), false, false)\r\n\r\n    if type == \"Gem\" then\r\n        searchGem(card_stack.getName())\r\n    elseif type == \"Relic\" then\r\n        searchRelic(card_stack.getName())\r\n    elseif type == \"Spell\" then\r\n        searchSpell(card_stack.getName())\r\n    end\r\nend\r\n]]--\r\n\r\nfunction getShopCard(box, type, pos)\r\n  --print(marketBags[box])\r\n  --print(pos.getGUID() .. ' / ' .. tostring(pos.getPosition()))\r\n\r\n    cardBox = getObjectFromGUID(marketBags[box])\r\n    --print(box)\r\n    --print(cardBox)\r\n    --marketPos = zoneTable[pos]\r\n    cardBoxSize = tablelength(cardBox.getObjects())\r\n    if cardBoxSize == 0 then\r\n      broadcastToAll(\"You've either ran out of cards to randomise or something went wrong!\\nYou may have to fix this manually, grab a card from the randomiser decks!\",{r=1,g=0.7,b=0.7})\r\n      return(nil)\r\n    end\r\n    if type == \"CommentedOut\" then\r\n      possible_cards = cardBoxSize\r\n      chosen_card = math.random(0, possible_cards - 1)\r\n      params = {index = chosen_card, position = marketPos.getPosition() + vector(0,3,0), rotation = {x = 0, y = 180, z = 0}, smooth = false}\r\n      card_stack = cardBox.takeObject(params)\r\n    end\r\n  --  card_stack.setRotation({x = 0, y = 180, z = 0})\r\n    --card_stack.setPositionSmooth(market.getPosition() + vector(0,3,0), false, false)\r\n    local myCost = box\r\n    --print(tostring(pos.getPosition()))\r\n    if type == \"Gem\" then\r\n          searchDeck(getObjectFromGUID(gem_random_deck_id),myCost, pos.getPosition() +vector(0, 5 + barracksOffset, 0),{0,180,0},\"Des\",\"Cannot find a \" .. myCost .. \" randomizer card in deck.\")\r\n    elseif type == \"Relic\" then\r\n        --searchRelic(card_stack.getName())\r\n        searchDeck(getObjectFromGUID(relic_random_deck_id),myCost,pos.getPosition() + vector(0, 5 + barracksOffset, 0),{0,180,0},\"Des\",\"Cannot find a \" .. myCost .. \" randomizer card in deck.\")\r\n    elseif type == \"Spell\" then\r\n        --searchSpell(card_stack.getName())\r\n        searchDeck(getObjectFromGUID(spell_random_deck_id),myCost,pos.getPosition() + vector(0, 5 + barracksOffset, 0),{0,180,0},\"Des\",\"Cannot find a \" .. myCost .. \" randomizer card in deck.\")\r\n    end\r\n    barracksOffset = barracksOffset + 1\r\n    Wait.time(resetOffset,6)\r\n\r\nend\r\n\r\nfunction tablelength(T)\r\n  local count = 0\r\n  for _ in pairs(T) do count = count + 1 end\r\n  return count\r\nend\r\n\r\nfunction searchGem(name)\r\n    searchDeck(\r\n        getObjectFromGUID(gem_random_deck_id),\r\n        name,\r\n        barracksPos,\r\n        {0, 180, 0},\r\n        \"Name\",\r\n        \"Cannot find \" .. name .. \" randomizer card in deck.\"\r\n    )\r\nend\r\nfunction searchRelic(name)\r\n    searchDeck(\r\n        getObjectFromGUID(relic_random_deck_id),\r\n        name,\r\n        barracksPos,\r\n        {0, 180, 0},\r\n        \"Name\",\r\n        \"Cannot find \" .. name .. \" randomizer card in deck.\"\r\n    )\r\nend\r\nfunction searchSpell(name)\r\n    searchDeck(\r\n        getObjectFromGUID(spell_random_deck_id),\r\n        name,\r\n        barracksPos,\r\n        {0, 180, 0},\r\n        \"Name\",\r\n        \"Cannot find \" .. name .. \" randomizer card in deck.\"\r\n    )\r\nend\r\n\r\nfunction lockMarket()\r\n    locked = true\r\n    local buttonWidth = 320\r\n    local buttonHeight = 90\r\n    for i = 9, 27, 1 do\r\n          self.removeButton(i)\r\n    end\r\n    for i = 0, 9, 1 do\r\n        self.editButton({\r\n          index = i,\r\n          label = \"Buy/Gain\",\r\n          width = buttonWidth*1.2,\r\n          height = buttonHeight*2,\r\n          scale = {0.4,0.4,0.4},\r\n          tooltip = \"Adds the above card to your discard pile.\"})\r\n    end\r\n    broadcastToAll(\"Market has been locked!\", {r = 1, g = 0, b = 0.3})\r\n    getObjectFromGUID('b9111a').setVar('marketDone',true)\r\n    getObjectFromGUID('184d8b').setVar('marketDone',true)\r\nend\r\n\r\nfunction checkZone(zone)\r\n    for i = 0, 9, 1 do\r\n        if zone.getGUID() == zoneTable[i] then\r\n            return (true)\r\n        end\r\n    end\r\n    return (false)\r\nend\r\n\r\nfunction onObjectEnterScriptingZone(zone, info)\r\n    local foundZone = checkZone(zone)\r\n    if foundZone == false or info == nil then\r\n        --print(\"not a zone\")\r\n        return (nil)\r\n    end\r\n    if (foundZone == true and (info.getGMNotes() ~= \"Swap Randomiser\" and info.getGMNotes() ~= \"Market Randomiser\" and info.getGMNotes() ~= \"Market Randomizer\")) then\r\n        --print(\"not a market card\")\r\n        return (nil)\r\n    else\r\n        if (foundZone == true) then\r\n          local error = ''\r\n          if (preventError == false) then\r\n            error = \"No market card by the name '\" ..\r\n                info.getName() .. \"' found. \\n The card is supposed to be in bag: \" .. info.getDescription()\r\n          end\r\n            local myZone = getObjectFromGUID(zone.getGUID())\r\n            searchDeck(\r\n                getObjectFromGUID(marketBags[info.getDescription()]),\r\n                info.getName(),\r\n                myZone.getPosition() + vector(0, 4, 0),\r\n                {0, 180, 0},\r\n                \"Name\",\r\n                error\r\n            )\r\n            local myPos2 = getObjectFromGUID(\"d089df\").getPosition()\r\n            -- info.setPositionSmooth(myPos2 + vector(0, 8 + barracksOffset*0.5, 0), false, true)\r\n            info.setPosition(myPos2 + vector(0, 8 + barracksOffset, 0), false, true)\r\n            info.setRotation({0, 180, 0})\r\n            barracksOffset = barracksOffset + 1\r\n            Wait.time(resetOffset,2)\r\n            preventError = true\r\n            Wait.time(resetError,4)\r\n        end\r\n        if info.getGMNotes() == \"Swap Randomiser\" then\r\n            error = \"No swap market card by the name '\" ..\r\n            swapDictionary[info.getName()] .. \"' found. \\n The card is supposed to be in bag: \" .. swapBag\r\n            searchDeck(\r\n                getObjectFromGUID(swapBag),\r\n                swapDictionary[info.getName()],\r\n                swapPosition + vector(swapCount * 2.9, 4, 0),\r\n                {0, 180, 0},\r\n                \"Name\",\r\n                error\r\n            )\r\n            --printToAll(\"The Swap card \" .. swapDictionary[info.getName()] .. \" has been added to the Swap Zone.\", {r = 1, g = 1, b = 0.8})\r\n            swapCount = swapCount + 1\r\n        end\r\n    end\r\nend\r\n\r\nfunction searchDeck(deck, charName, pos, rot, nameOrDes, error)\r\n    for _, card in pairs(deck.getObjects()) do\r\n        if (nameOrDes == \"Des\" and card.description == charName) or (nameOrDes == \"Name\" and card.name == charName) then\r\n            return (deck.takeObject({guid = card.guid, position = pos, rotation = rot, smooth = false}))\r\n        end\r\n    end\r\n    local myError = error or \"\"\r\n    if (myError ~= \"\") then\r\n        broadcastToAll(error, {r = 1, g = 0, b = 0})\r\n    end\r\nend\r\n\r\n-- i dunno how else to do this with multiple buttons so..\r\nfunction Card1(obj, player_clicker_color, alt_click)\r\n    local num = 1\r\n    if locked == true then\r\n        buyCard(num, player_clicker_color)\r\n    else\r\n        rerollCard(num, alt_click)\r\n    end\r\nend\r\nfunction Card1p(obj, player_clicker_color, alt_click)\r\n    local num = 1\r\n    cost_plus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card1m(obj, player_clicker_color, alt_click)\r\n    local num = 1\r\n    cost_minus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card2(obj, player_clicker_color, alt_click)\r\n    local num = 2\r\n    if locked == true then\r\n        buyCard(num, player_clicker_color)\r\n    else\r\n        rerollCard(num, alt_click)\r\n    end\r\nend\r\nfunction Card2p(obj, player_clicker_color, alt_click)\r\n    local num = 2\r\n    cost_plus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card2m(obj, player_clicker_color, alt_click)\r\n    local num = 2\r\n    cost_minus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card3(obj, player_clicker_color, alt_click)\r\n    local num = 3\r\n    if locked == true then\r\n        buyCard(num, player_clicker_color)\r\n    else\r\n        rerollCard(num, alt_click)\r\n    end\r\nend\r\nfunction Card3p(obj, player_clicker_color, alt_click)\r\n    local num = 3\r\n    cost_plus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card3m(obj, player_clicker_color, alt_click)\r\n    local num = 3\r\n    cost_minus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card4(obj, player_clicker_color, alt_click)\r\n    local num = 4\r\n    if locked == true then\r\n        buyCard(num, player_clicker_color)\r\n    else\r\n        rerollCard(num, alt_click)\r\n    end\r\nend\r\nfunction Card4p(obj, player_clicker_color, alt_click)\r\n    local num = 4\r\n    cost_plus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card4m(obj, player_clicker_color, alt_click)\r\n    local num = 4\r\n    cost_minus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card5(obj, player_clicker_color, alt_click)\r\n    local num = 5\r\n    if locked == true then\r\n        buyCard(num, player_clicker_color)\r\n    else\r\n        rerollCard(num, alt_click)\r\n    end\r\nend\r\nfunction Card5p(obj, player_clicker_color, alt_click)\r\n    local num = 5\r\n    cost_plus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card5m(obj, player_clicker_color, alt_click)\r\n    local num = 5\r\n    cost_minus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card6(obj, player_clicker_color, alt_click)\r\n    local num = 6\r\n    if locked == true then\r\n        buyCard(num, player_clicker_color)\r\n    else\r\n        rerollCard(num, alt_click)\r\n    end\r\nend\r\nfunction Card6p(obj, player_clicker_color, alt_click)\r\n    local num = 6\r\n    cost_plus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card6m(obj, player_clicker_color, alt_click)\r\n    local num = 6\r\n    cost_minus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card7(obj, player_clicker_color, alt_click)\r\n    local num = 7\r\n    if locked == true then\r\n        buyCard(num, player_clicker_color)\r\n    else\r\n        rerollCard(num, alt_click)\r\n    end\r\nend\r\nfunction Card7p(obj, player_clicker_color, alt_click)\r\n    local num = 7\r\n    cost_plus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card7m(obj, player_clicker_color, alt_click)\r\n    local num = 7\r\n    cost_minus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card8(obj, player_clicker_color, alt_click)\r\n    local num = 8\r\n    if locked == true then\r\n        buyCard(num, player_clicker_color)\r\n    else\r\n        rerollCard(num, alt_click)\r\n    end\r\nend\r\nfunction Card8p(obj, player_clicker_color, alt_click)\r\n    local num = 8\r\n    cost_plus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card8m(obj, player_clicker_color, alt_click)\r\n    local num = 8\r\n    cost_minus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card9(obj, player_clicker_color, alt_click)\r\n    local num = 9\r\n    if locked == true then\r\n        buyCard(num, player_clicker_color)\r\n    else\r\n        rerollCard(num, alt_click)\r\n    end\r\nend\r\nfunction Card9p(obj, player_clicker_color, alt_click)\r\n    local num = 9\r\n    cost_plus = true\r\n    rerollCard(num, alt_click)\r\nend\r\nfunction Card9m(obj, player_clicker_color, alt_click)\r\n    local num = 9\r\n    cost_minus = true\r\n    rerollCard(num, alt_click)\r\nend",
  "LuaScriptState": "",
  "XmlUI": "",
  "AttachedSnapPoints": [
    {
      "Position": {
        "x": 0.465745568,
        "y": 0.199454069,
        "z": -0.6429231
      }
    },
    {
      "Position": {
        "x": -0.481150329,
        "y": 0.198828086,
        "z": 0.639846
      }
    },
    {
      "Position": {
        "x": -0.484956741,
        "y": 0.198886946,
        "z": 0.0002772404
      }
    },
    {
      "Position": {
        "x": -0.481835485,
        "y": 0.200618759,
        "z": -0.6424703
      }
    },
    {
      "Position": {
        "x": -0.00580305746,
        "y": 0.200382531,
        "z": -0.642622352
      }
    },
    {
      "Position": {
        "x": -0.0055909357,
        "y": 0.199716315,
        "z": -0.000466143742
      }
    },
    {
      "Position": {
        "x": 0.465928376,
        "y": 0.202342719,
        "z": -0.000843478
      }
    },
    {
      "Position": {
        "x": 0.466109782,
        "y": 0.200567067,
        "z": 0.639229655
      }
    },
    {
      "Position": {
        "x": -0.00540033728,
        "y": 0.199296311,
        "z": 0.639702737
      }
    }
  ]
}